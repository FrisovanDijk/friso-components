<!doctype html>
<head>
    <title>JS implementation</title>
    <link rel="stylesheet" href="../../source/css/main.css">
    <script src="../res/components.js"></script>
    <script src="../res/docbuild.js"></script>
</head>
<body>
<div id="header" class="w-100 h2"></div>

<div class="container">
    <h1>JS implementation</h1>

    <div class="row">
        <div class="col-3" id="card_intro"></div>
        <div class="col-9">
            <div class="f-card f-card--rich">
                <p>components.js</p>
<pre><code>if(window.location.origin.includes("localhost")) {
    var apiUrl = window.location.origin + "/";
} else {
    var apiUrl = "https://www.frisovandijk.com/components/";
}
const baseUrl = window.location.origin + "/docs/";

// Makes the server API call
function getComponent(name, vars) {
    const host = apiUrl;
    const url = "index.php";
    const url_vars = btoa(JSON.stringify(vars));
    const request_url = `${host}${url}?name=${name}&vars=${url_vars}`;

    // Debug mode
    console.log(request_url);

    return fetch(request_url)
    .then(function(response) {
        return response.text();
    })
    .then(function(html) {
        return html;
    }).catch(function(error) {
        console.warn(error);
    })
}

// Makes the API call and parses the HTML without further processing
function parseComponentHTML(id, data) {
    // Grab the component
    getComponent(data['name'], data['vars']).then(function(html) {
        // When the Promise is fulfilled inject the HTML in the DOM
        document.querySelector(id).innerHTML = html;
    })
}

// Parse component as HTML child with provided child_id
function parseComponentHTMLChild(container_id, child_id, data) {
    var child = document.createElement("div");
    child.setAttribute("id", child_id);
    document.querySelector(container_id).appendChild(child);

    // Grab the component
    getComponent(data['name'], data['vars']).then(function(html) {
        // When the Promise is fulfilled inject the HTML in the DOM
        document.getElementById(child_id).innerHTML = html;
    })
    }

// PARTICLES

// MODAL
function show_modal(container_id, data) {
    var child_id = Date.now();
    parseComponentHTMLChild(container_id, child_id, data);

    var modal = document.getElementById(child_id);

    modal.style.display = "block";
    modal.addEventListener("click", function(){
        modal.style.display = "none"
    });
}
</code></pre>
            </div>
        </div>
    </div>
</div>
</body>
<div id="footer"></div>
<script>
    // Header & Footer
    parseComponentHTML("#header", {"name":"docs-header", "vars": { "baseUrl": baseUrl}});
    parseComponentHTML("#footer", {"name":"docs-footer", "vars": {}});

    // Card intro
    data = {
        "name": "card-fixed",
        "vars": {
            "title": "Front end JS",
            "description": "A lightweight implementation using the fetch API to asynchronously load components.",
            "class": "f-card--primary f-card__title--secondary",
            "short?": true
        }
    };
    parseComponentHTML("#card_intro", data);
</script>